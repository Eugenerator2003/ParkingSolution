<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Create</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../css/Style.css" rel="stylesheet">
    <script type="text/javascript" src="../js/DataProviding.js"></script>
</head>
<body>

    <div class="container">
        <div class="row">
            <div class="col-md-5">
                <h3>Car creating</h3>
                <hr />
                <form name="carForm">
                    <input type="hidden" name="id" value="0" />
                    <div class="form-floating mb-2">
                        Number: <input asp-for="Number" class="form-control" name="number" />
                    </div>
                    <div class="form-floating mb-2">
                        Mark: <select asp-for="CarMarkId" class="form-control" name="carMark"></select>
                    </div>
                    <div class="form-floating mb-3">
                        Owner: <select asp-for="OwnerId" class="form-control" name="owner"></select>
                    </div>

                    <div class="form-floating">
                        <input type="submit" id="submit" value="Create" class="btn btn-secondary" />
                        <a href="index.html" class="btn btn-primary">Back</a>
                        <input type="reset" value="Reset" class="btn btn-primary">
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
		window.onload = function () {
            GetAllMarks();
            GetAllOwners();
        }

        //Функция создания новой записи о машине
		async function CreateCar(number, carMarkId, ownerId) {
            const response = await fetch("https://localhost:7254/api/Cars/", {
                method: "POST",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({

                    number: number,
                    carMarkId: parseInt(carMarkId, 10),
                    ownerId: parseInt(ownerId, 10),

                })
            });
            if (response.ok === true) {
                const film = await response.json();
                alert("Record was successful created");
                window.location = "index.html";
            }
			else {
                alert("Invalid data");
			}
        }

		document.forms["carForm"].addEventListener("submit", e => {
			e.preventDefault();
			const form = document.forms["carForm"];

			const number = form.elements["number"].value;

			const carMarkId = form.elements["carMark"].value;
			const ownerId = form.elements["owner"].value;

            CreateCar(number, carMarkId, ownerId);
		});</script>
</body>
</html>